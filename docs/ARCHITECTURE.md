# OpenWrt ç¼–è¯‘å™¨æ¶æ„è®¾è®¡

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†OpenWrtç¼–è¯‘å™¨çš„ç³»ç»Ÿæ¶æ„ã€è®¾è®¡ç†å¿µå’ŒæŠ€æœ¯å†³ç­–ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Webæµè§ˆå™¨  â”‚  ç§»åŠ¨ç«¯æµè§ˆå™¨  â”‚  æ¡Œé¢åº”ç”¨  â”‚  APIå®¢æˆ·ç«¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTML5/CSS3  â”‚  JavaScript ES6+  â”‚  Socket.IO Client       â”‚
â”‚  å“åº”å¼è®¾è®¡   â”‚  æ¨¡å—åŒ–æ¶æ„       â”‚  å®æ—¶é€šä¿¡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç½‘ç»œå±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP/HTTPS  â”‚  WebSocket  â”‚  RESTful API  â”‚  JSONæ•°æ®æ ¼å¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯æœåŠ¡å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Flask Webæ¡†æ¶  â”‚  Flask-SocketIO  â”‚  APIè·¯ç”±  â”‚  ä¸­é—´ä»¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¼–è¯‘ç®¡ç†å™¨  â”‚  é…ç½®ç®¡ç†å™¨  â”‚  æ–‡ä»¶ç®¡ç†å™¨  â”‚  WebSocketå¤„ç†å™¨ â”‚
â”‚  GitåŠ©æ‰‹     â”‚  è¿›ç¨‹ç®¡ç†å™¨  â”‚  æ¶ˆæ¯é˜Ÿåˆ—    â”‚  æ—¥å¿—ç®¡ç†å™¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶ç³»ç»Ÿ  â”‚  é…ç½®æ–‡ä»¶  â”‚  æ—¥å¿—æ–‡ä»¶  â”‚  ä¸´æ—¶æ–‡ä»¶  â”‚  ç¼“å­˜     â”‚
â”‚  Gitä»“åº“   â”‚  å›ºä»¶æ–‡ä»¶  â”‚  ä¸Šä¼ æ–‡ä»¶  â”‚  ç¼–è¯‘è¾“å‡º  â”‚  å…ƒæ•°æ®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. å‰ç«¯ç»„ä»¶
- **ç”¨æˆ·ç•Œé¢**: ç°ä»£åŒ–å“åº”å¼Webç•Œé¢
- **çŠ¶æ€ç®¡ç†**: é›†ä¸­å¼åº”ç”¨çŠ¶æ€ç®¡ç†
- **APIå®¢æˆ·ç«¯**: ç»Ÿä¸€çš„åç«¯æ¥å£è°ƒç”¨
- **å®æ—¶é€šä¿¡**: WebSocketå®¢æˆ·ç«¯ç®¡ç†
- **å·¥å…·åº“**: é€šç”¨å·¥å…·å‡½æ•°é›†åˆ

#### 2. åç«¯ç»„ä»¶
- **WebæœåŠ¡å™¨**: Flaskåº”ç”¨æœåŠ¡å™¨
- **APIç½‘å…³**: RESTful APIè·¯ç”±å’Œä¸­é—´ä»¶
- **ä¸šåŠ¡æœåŠ¡**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†
- **æ•°æ®è®¿é—®**: æ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®æ“ä½œ
- **å¤–éƒ¨é›†æˆ**: Gitã€ç¼–è¯‘å·¥å…·é“¾é›†æˆ

#### 3. åŸºç¡€è®¾æ–½
- **æ¶ˆæ¯é˜Ÿåˆ—**: å¼‚æ­¥ä»»åŠ¡å¤„ç†
- **æ—¥å¿—ç³»ç»Ÿ**: ç»“æ„åŒ–æ—¥å¿—è®°å½•
- **ç›‘æ§ç³»ç»Ÿ**: å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§
- **å®‰å…¨æœºåˆ¶**: è®¤è¯ã€æˆæƒå’Œæ•°æ®ä¿æŠ¤

## ğŸ¯ è®¾è®¡ç†å¿µ

### 1. æ¨¡å—åŒ–è®¾è®¡
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½
- **æ¾è€¦åˆ**: æ¨¡å—é—´é€šè¿‡æ˜ç¡®æ¥å£äº¤äº’
- **é«˜å†…èš**: ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ¨¡å—

### 2. å‰åç«¯åˆ†ç¦»
- **ç‹¬ç«‹å¼€å‘**: å‰åç«¯å¯ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- **æŠ€æœ¯é€‰å‹**: å„å±‚å¯é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯æ ˆ
- **æ¥å£æ ‡å‡†**: é€šè¿‡æ ‡å‡†APIè¿›è¡Œæ•°æ®äº¤æ¢
- **éƒ¨ç½²çµæ´»**: æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼

### 3. äº‹ä»¶é©±åŠ¨æ¶æ„
- **å¼‚æ­¥å¤„ç†**: é•¿æ—¶é—´ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ
- **å®æ—¶åé¦ˆ**: é€šè¿‡äº‹ä»¶æä¾›å®æ—¶çŠ¶æ€æ›´æ–°
- **è§£è€¦åˆ**: ç»„ä»¶é—´é€šè¿‡äº‹ä»¶é€šä¿¡
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†å™¨

### 4. å®‰å…¨ä¼˜å…ˆ
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„è¾“å…¥æ•°æ®éªŒè¯
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **æ•°æ®ä¿æŠ¤**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡è®°å½•

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### åç«¯æŠ€æœ¯æ ˆ

#### Flask Webæ¡†æ¶
```python
# åº”ç”¨ç»“æ„ (åŸºäºå®é™…çš„app.py)
from flask import Flask, request, jsonify
from flask_socketio import SocketIO
from flask_cors import CORS

app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-secret-key'

# å¯ç”¨CORS
CORS(app)

# åˆå§‹åŒ–SocketIO
socketio = SocketIO(app, cors_allowed_origins="*")

# APIè·¯ç”±ç›´æ¥åœ¨app.pyä¸­å®šä¹‰
@app.route('/api/status')
def get_status():
    return jsonify({
        'success': True,
        'data': {
            'server': 'running',
            'version': '1.0.0',
            'config': app.config.get('ENV', 'development')
        }
    })
```

#### ä¾èµ–æ³¨å…¥å’Œé…ç½®ç®¡ç†
```python
# config.py
class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY')
    WORKSPACE_DIR = os.environ.get('WORKSPACE_DIR', './workspace')
    
class DevelopmentConfig(Config):
    DEBUG = True
    LOG_LEVEL = 'DEBUG'

class ProductionConfig(Config):
    DEBUG = False
    LOG_LEVEL = 'INFO'
```

#### å¼‚æ­¥ä»»åŠ¡å¤„ç†
```python
# ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†é•¿æ—¶é—´ä»»åŠ¡
from concurrent.futures import ThreadPoolExecutor
import threading

class TaskManager:
    def __init__(self):
        self.executor = ThreadPoolExecutor(max_workers=4)
        self.tasks = {}
    
    def submit_task(self, task_func, *args, **kwargs):
        future = self.executor.submit(task_func, *args, **kwargs)
        task_id = str(uuid.uuid4())
        self.tasks[task_id] = future
        return task_id
```

### å‰ç«¯æŠ€æœ¯æ ˆ

#### æ¨¡å—åŒ–JavaScriptæ¶æ„
```javascript
// ä¸»åº”ç”¨ç±»
class OpenWrtCompiler {
    constructor() {
        this.api = new APIClient();
        this.websocket = new WebSocketManager();
        this.state = new StateManager();
    }
    
    async init() {
        await this.initElements();
        await this.initEventListeners();
        await this.connectWebSocket();
        await this.loadInitialData();
    }
}

// APIå®¢æˆ·ç«¯
class APIClient {
    constructor(baseUrl) {
        this.baseUrl = baseUrl;
        this.timeout = 30000;
    }
    
    async call(endpoint, options = {}) {
        // ç»Ÿä¸€çš„APIè°ƒç”¨é€»è¾‘
    }
}
```

#### çŠ¶æ€ç®¡ç†
```javascript
class StateManager {
    constructor() {
        this.state = {
            connected: false,
            compiling: false,
            currentTab: 'logs'
        };
        this.listeners = [];
    }
    
    setState(newState) {
        const oldState = { ...this.state };
        this.state = { ...this.state, ...newState };
        this.notifyListeners(oldState, this.state);
    }
    
    subscribe(listener) {
        this.listeners.push(listener);
    }
}
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. ç”¨æˆ·æ“ä½œæµç¨‹

```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯äº‹ä»¶å¤„ç† â†’ APIè°ƒç”¨ â†’ åç«¯å¤„ç† â†’ æ•°æ®åº“æ“ä½œ â†’ å“åº”è¿”å› â†’ å‰ç«¯æ›´æ–°
```

#### ç¼–è¯‘æµç¨‹ç¤ºä¾‹
```
1. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹ç¼–è¯‘"
2. å‰ç«¯éªŒè¯è¾“å…¥å‚æ•°
3. è°ƒç”¨ POST /api/compile/start
4. åç«¯éªŒè¯æƒé™å’Œå‚æ•°
5. åˆ›å»ºç¼–è¯‘ä»»åŠ¡
6. è¿”å›ä»»åŠ¡ID
7. å‰ç«¯å¼€å§‹è½®è¯¢çŠ¶æ€
8. åç«¯é€šè¿‡WebSocketæ¨é€è¿›åº¦
9. å‰ç«¯å®æ—¶æ›´æ–°ç•Œé¢
```

### 2. WebSocketäº‹ä»¶æµ

```
å®¢æˆ·ç«¯è¿æ¥ â†’ æœåŠ¡å™¨ç¡®è®¤ â†’ è®¢é˜…äº‹ä»¶ â†’ åŠ å…¥æˆ¿é—´ â†’ æ¥æ”¶å®æ—¶æ•°æ®
```

#### äº‹ä»¶ç±»å‹
- **ç³»ç»Ÿäº‹ä»¶**: è¿æ¥ã€æ–­å¼€ã€é”™è¯¯
- **ç¼–è¯‘äº‹ä»¶**: å¼€å§‹ã€è¿›åº¦ã€å®Œæˆã€é”™è¯¯
- **æ–‡ä»¶äº‹ä»¶**: ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤
- **é…ç½®äº‹ä»¶**: åˆ›å»ºã€æ›´æ–°ã€åº”ç”¨

### 3. æ•°æ®æŒä¹…åŒ–

#### æ–‡ä»¶ç³»ç»Ÿç»“æ„
```
workspace/
â”œâ”€â”€ lede/                 # Gitä»“åº“
â”œâ”€â”€ configs/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ templates/        # é…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ user/            # ç”¨æˆ·é…ç½®
â”œâ”€â”€ firmware/            # ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ uploads/             # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ temp/               # ä¸´æ—¶æ–‡ä»¶
â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
```

#### å…ƒæ•°æ®ç®¡ç†
```json
{
  "config_name": "x86_64_basic",
  "created_at": "2025-06-25T10:30:00Z",
  "target": "x86/64",
  "size": 1024,
  "md5": "d41d8cd98f00b204e9800998ecf8427e",
  "metadata": {
    "description": "x86_64åŸºç¡€é…ç½®",
    "author": "admin",
    "version": "1.0"
  }
}
```

## ğŸ” å®‰å…¨æ¶æ„

### 1. è¾“å…¥éªŒè¯
```python
from marshmallow import Schema, fields, validate

class CompileRequestSchema(Schema):
    config_name = fields.Str(required=True, validate=validate.Length(min=1, max=100))
    target = fields.Str(validate=validate.OneOf(['all', 'kernel', 'packages']))
    threads = fields.Int(validate=validate.Range(min=1, max=32))
    clean = fields.Bool()

def validate_compile_request(data):
    schema = CompileRequestSchema()
    return schema.load(data)
```

### 2. æ–‡ä»¶å®‰å…¨
```python
import os
import hashlib
from werkzeug.utils import secure_filename

def secure_file_upload(file, upload_dir):
    # éªŒè¯æ–‡ä»¶å
    filename = secure_filename(file.filename)
    
    # éªŒè¯æ–‡ä»¶ç±»å‹
    allowed_extensions = {'.config', '.txt'}
    if not any(filename.endswith(ext) for ext in allowed_extensions):
        raise ValueError("ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹")
    
    # éªŒè¯æ–‡ä»¶å¤§å°
    if len(file.read()) > 100 * 1024 * 1024:  # 100MB
        raise ValueError("æ–‡ä»¶è¿‡å¤§")
    
    # è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
    file.seek(0)
    file_hash = hashlib.md5(file.read()).hexdigest()
    
    # ä¿å­˜æ–‡ä»¶
    file.seek(0)
    filepath = os.path.join(upload_dir, filename)
    file.save(filepath)
    
    return filepath, file_hash
```

### 3. è¿›ç¨‹éš”ç¦»
```python
import subprocess
import shlex

def safe_execute(command, cwd=None, timeout=3600):
    """å®‰å…¨æ‰§è¡Œå¤–éƒ¨å‘½ä»¤"""
    # å‘½ä»¤ç™½åå•éªŒè¯
    allowed_commands = ['git', 'make', 'cp', 'mv', 'rm']
    cmd_parts = shlex.split(command)
    if cmd_parts[0] not in allowed_commands:
        raise ValueError(f"ä¸å…è®¸çš„å‘½ä»¤: {cmd_parts[0]}")
    
    # æ‰§è¡Œå‘½ä»¤
    try:
        result = subprocess.run(
            cmd_parts,
            cwd=cwd,
            timeout=timeout,
            capture_output=True,
            text=True,
            check=False
        )
        return result
    except subprocess.TimeoutExpired:
        raise TimeoutError("å‘½ä»¤æ‰§è¡Œè¶…æ—¶")
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: æŒ‰éœ€åŠ è½½JavaScriptæ¨¡å—
- **èµ„æºå‹ç¼©**: CSS/JSæ–‡ä»¶å‹ç¼©å’Œåˆå¹¶
- **ç¼“å­˜ç­–ç•¥**: æµè§ˆå™¨ç¼“å­˜å’ŒCDNåŠ é€Ÿ
- **æ‡’åŠ è½½**: å›¾ç‰‡å’Œç»„ä»¶æ‡’åŠ è½½

### 2. åç«¯ä¼˜åŒ–
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ç®¡ç†
- **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
- **å¼‚æ­¥å¤„ç†**: é•¿æ—¶é—´ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ
- **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹è´Ÿè½½åˆ†å‘

### 3. ç³»ç»Ÿä¼˜åŒ–
- **èµ„æºç›‘æ§**: CPUã€å†…å­˜ã€ç£ç›˜ç›‘æ§
- **æ—¥å¿—è½®è½¬**: è‡ªåŠ¨æ—¥å¿—æ¸…ç†å’Œå½’æ¡£
- **åƒåœ¾å›æ”¶**: ä¸´æ—¶æ–‡ä»¶å®šæœŸæ¸…ç†
- **ç¼–è¯‘ç¼“å­˜**: ccacheåŠ é€Ÿé‡å¤ç¼–è¯‘

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•
```python
# å¤šå®ä¾‹éƒ¨ç½²
class LoadBalancer:
    def __init__(self, instances):
        self.instances = instances
        self.current = 0
    
    def get_instance(self):
        instance = self.instances[self.current]
        self.current = (self.current + 1) % len(self.instances)
        return instance
```

### 2. æ’ä»¶ç³»ç»Ÿ
```python
# æ’ä»¶æ¥å£
class CompilerPlugin:
    def before_compile(self, config):
        pass
    
    def after_compile(self, result):
        pass
    
    def on_error(self, error):
        pass

# æ’ä»¶ç®¡ç†å™¨
class PluginManager:
    def __init__(self):
        self.plugins = []
    
    def register_plugin(self, plugin):
        self.plugins.append(plugin)
    
    def trigger_event(self, event, *args, **kwargs):
        for plugin in self.plugins:
            getattr(plugin, event, lambda *a, **k: None)(*args, **kwargs)
```

### 3. å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebæœåŠ¡    â”‚  â”‚   ç¼–è¯‘æœåŠ¡   â”‚  â”‚   æ–‡ä»¶æœåŠ¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   æ¶ˆæ¯é˜Ÿåˆ—   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### 1. å•æœºéƒ¨ç½²
```yaml
# docker-compose.yml
version: '3.8'
services:
  openwrt-compiler:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - FLASK_ENV=production
```

### 2. é›†ç¾¤éƒ¨ç½²
```yaml
# kubernetes deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openwrt-compiler
spec:
  replicas: 3
  selector:
    matchLabels:
      app: openwrt-compiler
  template:
    metadata:
      labels:
        app: openwrt-compiler
    spec:
      containers:
      - name: openwrt-compiler
        image: openwrt-compiler:latest
        ports:
        - containerPort: 5000
```

---

**æœ¬æ¶æ„è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œé«˜æ€§èƒ½ï¼Œä¸ºOpenWrtç¼–è¯‘å™¨çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚**
